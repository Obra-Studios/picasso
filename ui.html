<!DOCTYPE html>
<html>

<head>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #FFF9F0;
            padding: 24px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            min-height: 100vh;
            overflow-y: auto;
        }

        .logo-container {
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            max-width: 720px;
            padding: 0 6px;
        }

        .logo {
            width: 90px;
            height: 90px;
            display: block;
            flex: 0 0 auto;
            overflow: visible;
        }
        
        /* Animation for logo paths */
        .logo path {
            transform-box: fill-box;
            transform-origin: center;
            transition: transform 0.5s ease-in-out;
        }

        .wordmark {
            width: 100px; /* slightly smaller */
            height: auto;
            display: block;
            flex: 0 0 auto;
            opacity: 0.95;
            transform-origin: center;
            transition: transform 1.2s ease-in-out;
        }

        /* Inline toggle (placed inside the same row) */
        #tracking-toggle-container {
            margin-left: auto; /* push toggle to the right */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #tracking-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 6px;
            border-radius: 0;
            border: none;
            background: transparent;
            cursor: pointer;
            color: rgba(0,0,0,0.66);
            transition: color 0.2s ease, filter 0.2s ease;
        }

        #tracking-toggle[aria-pressed="true"] {
            color: #5a9d5f; /* brighter green for clear visibility */
            filter: drop-shadow(0 0 12px rgba(90,157,95,0.6)) drop-shadow(0 0 6px rgba(90,157,95,0.4)); /* stronger green glow/hue */
        }

        h1 {
            font-size: 18px;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 8px;
            text-align: center;
        }

        .subtitle {
            font-size: 12px;
            color: #666;
            text-align: center;
            margin-bottom: 32px;
            line-height: 1.5;
            max-width: 280px;
        }

        .button-container {
            width: 100%;
            max-width: 100%;
            display: flex;
            flex-direction: column;
            /* use remaining viewport height so the event stream can expand */
            height: calc(100vh - 200px);
            padding: 0 18px;
            margin-top: 24px;
        }

        button {
            width: 100%;
            padding: 14px 20px;
            background: #1a1a1a;
            color: #FFF9F0;
            border: none;
            border-radius: 0;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 12px;
        }

        button:active {
            transform: translateY(0);
        }

        .stop-button {
            background: #d4380d;
        }

        .stop-button:hover {
            background: #ad2102;
        }

        .status {
            width: 100%;
            max-width: 280px;
            font-size: 11px;
            padding: 12px 16px;
            background: #fff;
            border-radius: 0;
            margin-top: 8px;
            line-height: 1.5;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
            display: none;
        }

        .status.visible {
            display: block;
        }

        .status.processing {
            color: #1a1a1a;
            border-left: 3px solid #faad14;
        }

        .status.success {
            color: #237804;
            border-left: 3px solid #52c41a;
        }

        .status.error {
            color: #cf1322;
            border-left: 3px solid #f5222d;
        }

        .interpretation {
            width: 100%;
            max-width: 280px;
            margin-top: 16px;
            padding: 16px;
            background: #fff;
            border-radius: 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
            display: none;
        }

        .interpretation.visible {
            display: block;
        }

        .interpretation-title {
            font-size: 11px;
            font-weight: 600;
            color: #8b5cf6;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .interpretation-text {
            font-size: 12px;
            color: #333;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .actions-count {
            font-size: 10px;
            color: #999;
            font-style: italic;
        }

        /* Minimal textarea: no backdrop, no outline ‚Äî just a black bottom line and native caret */
        .minimal-textarea {
            width: 100%;
            padding: 2px 4px 4px 4px; /* added bottom padding so text doesn't touch the line */
            font-size: 12px;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            border: none; /* underline handled by separate element so it can be positioned */
            background: transparent;
            resize: none;
            min-height: 18px;
            line-height: 1.4; /* increased line height */
            caret-color: rgba(0,0,0,0.62);
            color: rgba(0,0,0,0.62); /* match event-title color */
            appearance: none;
            -webkit-appearance: none;
        }

        .minimal-textarea::placeholder {
            color: #9b9b9b;
            opacity: 1;
        }

        .minimal-textarea:focus {
            outline: none;
            box-shadow: none;
            border-bottom-color: #000;
        }

        /* Simple inline text links for context/canvas selectors */
        /* Frame selector pills */
        .frame-selectors {
            display: flex;
            flex-wrap: nowrap;
            gap: 8px;
            margin-bottom: 8px;
            flex-direction: row;
        }

        .frame-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 6px 6px 12px;
            background: rgba(0, 0, 0, 0.04);
            border: 1.5px solid rgba(0, 0, 0, 0.12);
            border-radius: 16px;
            font-size: 12px;
            color: #333;
            max-width: 200px;
            transition: all 0.2s ease;
            cursor: pointer;
            flex: 1;
            margin: 0;
        }

        .frame-pill:hover {
            background: rgba(0, 0, 0, 0.06);
            border-color: rgba(0, 0, 0, 0.18);
            transform: translateY(-1px);
        }
        
        .frame-pill:active {
            transform: translateY(0);
        }

        .frame-pill-label {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            font-weight: 500;
            line-height: 1.2;
        }

        .frame-pill-icon {
            font-size: 11px;
            opacity: 0.7;
        }

        .frame-pill-remove {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            padding: 0;
            margin: 0;
            background: rgba(0, 0, 0, 0.1);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 10px;
            line-height: 1;
            color: #666;
            transition: all 0.15s ease;
            flex-shrink: 0;
        }

        .frame-pill-remove:hover {
            background: rgba(0, 0, 0, 0.2);
            color: #333;
        }

        .frame-select-button {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 6px 12px;
            background: transparent;
            border: 1.5px dashed rgba(0, 0, 0, 0.2);
            border-radius: 16px;
            font-size: 12px;
            color: #666;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            white-space: nowrap;
            margin: 0;
            flex: 1;
        }

        .frame-select-button:hover {
            background: rgba(0, 0, 0, 0.04);
            border-color: rgba(0, 0, 0, 0.3);
            color: #555;
        }

        .frame-select-button-icon {
            font-size: 11px;
        }

        /* wrapper keeps a fixed visual area while textarea inside auto-sizes up to the wrapper height */
        .textarea-wrapper {
            width: 100%;
            height: 120px; /* visual fixed height for layout (increased cap) */
            position: relative;
            overflow: hidden;
            margin-top: 20px;
        }

        /* bottom fade mask so text doesn't cut off abruptly at the black line */
        .textarea-wrapper::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            bottom: 1px; /* positioned above the black line so it remains fully visible */
            height: 14px;
            background: linear-gradient(to top, #FFF9F0 0%, rgba(255,249,240,0) 100%);
            pointer-events: none;
            z-index: 3;
        }

        .minimal-textarea {
            /* let the textarea auto-size; JS will cap to wrapper height */
            height: auto;
            max-height: 100%;
            overflow-y: auto;
            scrollbar-width: thin; /* Firefox */
            scrollbar-color: rgba(0,0,0,0.18) transparent;
            background: transparent;
            padding-right: 6px; /* space for tiny scrollbar */
        }

        .minimal-textarea::-webkit-scrollbar {
            width: 2px;
            height: 4px;
        }

        .minimal-textarea::-webkit-scrollbar-track {
            background: transparent;
        }

        .minimal-textarea::-webkit-scrollbar-thumb {
            background: rgba(0,0,0,0.18);
            border-radius: 2px;
        }

        /* underline element positioned under the live text */
        .textarea-underline {
            position: absolute;
            left: 0;
            right: 0;
            height: 1.5px;
            background: #000;
            pointer-events: none;
            bottom: 0; /* default: sit at bottom of wrapper */
            top: auto;
            z-index: 2;
        }

        /* Event stream: fixed to bottom, transparent background, compact events with fade masks */
        .event-stream {
            position: fixed;
            left: 50%;
            transform: translateX(-50%);
            bottom: 24px; /* match body padding */
            width: calc(100% - 48px);
            max-width: 280px;
            height: calc(100vh - 400px); /* fixed height instead of max-height to prevent squishing */
            background: transparent; /* no background */
            border-radius: 0;
            padding: 20px 10px 6px 10px; /* top padding 20px, bottom padding 6px */
            overflow-y: auto;
            overflow-x: hidden;
            font-size: 12px;
            color: rgba(0,0,0,0.48); /* subtler default text */
            line-height: 1.35;
            display: flex;
            flex-direction: column;
            justify-content: flex-end; /* align content to bottom */
            gap: 2px;
            z-index: 30;
        }

        /* individual events: single-line, no separators; title + muted detail inline with truncation */
        .event-stream .event {
            padding: 0;
            margin: 0;
            color: #666;
            font-size: 12px;
            opacity: 0.95;
            display: flex;
            gap: 8px;
            align-items: center;
            overflow: hidden;
            white-space: nowrap; /* keep a single line */
            flex-shrink: 0; /* prevent squishing */
        }

        .event-stream .event-title {
            color: rgba(0,0,0,0.62); /* slightly muted title */
            font-size: 12px;
            font-weight: 500;
            line-height: 1;
            margin: 0;
            flex: 0 0 auto;
            white-space: nowrap;
        }

        .event-stream .event-detail {
            color: rgba(0,0,0,0.36); /* more subtle detail */
            font-size: 11px;
            line-height: 1;
            margin: 0;
            flex: 1 1 auto; /* take remaining space */
            min-width: 0; /* allow truncation inside flex */
            overflow: hidden;
            text-overflow: ellipsis; /* show ‚Ä¶ when truncated */
            white-space: nowrap;
        }

        /* top fade overlay so events don't look abruptly cut off */
        .event-stream::before {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            height: 40px;
            pointer-events: none;
            background: linear-gradient(to bottom, #FFF9F0 0%, rgba(255,249,240,0) 100%);
            z-index: 1;
        }
    </style>
    <!-- Icons are inlined to comply with Figma plugin CSP (no external scripts) -->
</head>

<body>
    <div class="logo-container">
        <!-- Primary logo (icon) -->
        <!-- Begin animated picasso.svg content -->
        <svg class="logo" viewBox="0 0 1104 1396" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M837 1085C799 1002 717.5 1023.5 630.5 1048L576.5 1085V1224.5L837 1153.5V1085Z" fill="#549F65"/>
            <path d="M1025.77 692.727C1003.03 800.299 895.818 791.585 873.377 788.263C850.935 784.942 789.843 746.736 759.746 711.803C722.124 668.136 765.543 608.439 815 581C864.457 553.561 1048.5 585.156 1025.77 692.727Z" fill="#C54646"/>
            <path d="M104.563 353.258C104.563 353.258 412.168 282.698 523.254 274.708C628.298 267.155 847.603 296.578 930.737 385.418C943.564 399.123 989.334 286.902 989.334 286.902L757.18 182.562L698.649 31.6785L570.315 90.2192L444.125 39.5817L352.148 37.4363L213.701 226.238L38.5244 215.16L104.541 353.236L104.563 353.258Z" fill="#F0B800"/>
            <path d="M436.18 248.612C734.985 327.075 796.799 970.518 701.823 970.518H701.801C683.562 970.518 666.154 969.601 650 968.32L570.692 1104C598.251 1222.73 627.295 1360.96 561.603 1378.55C443.337 1410.21 252.226 1426.06 106.883 1174.54C-38.4588 923.012 -48.6152 121.307 436.18 248.612Z" fill="#57B8C1"/>
            <path d="M583.514 111.63C556.415 119.095 442.352 37.5676 393.65 47.5068C341.751 58.1028 274.027 166.208 264.243 216.605C410.592 219.473 557.006 201.477 701.604 181.621C713.577 179.979 732.183 183.875 732.139 169.864C732.117 159.356 691.667 52.3451 685.713 49.7399C668.486 42.1869 602.185 106.485 583.514 111.63Z" fill="#F0B800"/>
            <path d="M592.247 1235.79C561.406 1241.18 457.478 1258.49 434.013 1246.43C411.183 1234.7 417.64 1190.98 405.798 1179.53C402.033 1175.87 322.664 1150.56 307.189 1143.62C220.071 1104.61 86.8331 1007.06 36.817 925.222C23.3773 903.22 16.7012 893.741 28.0615 868.368C37.211 847.964 84.491 799.932 85.1039 782.002C85.87 760.131 37.5394 639.59 28.0615 608.109C22.4579 589.413 -1.55417 516.423 0.0875001 502.631C2.12317 485.533 49.7534 457.248 65.2507 446.257C74.4003 439.755 137.353 402.013 137.331 397.043C128.904 385.79 111.83 378.61 102.418 369.699C76.4359 345.114 51.5264 316.172 37.1454 282.983C27.3173 260.324 -0.744278 189.48 44.3468 188.144L213.57 211.81C248.286 136.544 316.294 -8.91038 417.837 2.84592C455.245 7.18064 554.226 64.3421 573.489 63.4664C610.262 61.7587 670.259 -40.0854 717.802 17.7985C740.26 45.1204 774.166 172.513 781.192 177.483C786.314 181.095 833.813 183.853 846.334 186.699C889.214 196.42 940.653 229.653 973.771 258.288C989.947 272.277 1025.84 298.505 1015.29 321.558C1004.74 344.589 923.426 405.297 920.23 423.489L1005.01 685.324C975.916 738.479 924.302 778.258 890.659 829.005L852.988 1163.13C849.048 1172.78 843.663 1174.29 835.017 1177.95C785.373 1198.97 649.487 1225.87 592.247 1235.86V1235.79ZM583.514 111.63C556.415 119.095 442.352 37.5675 393.65 47.5067C341.751 58.1027 274.027 166.208 264.243 216.605C410.592 219.473 557.006 201.477 701.604 181.62C713.577 179.978 732.183 183.875 732.139 169.864C732.117 159.356 691.667 52.345 685.713 49.7397C668.486 42.1868 602.185 106.485 583.514 111.63ZM541.969 245.021C539.167 242.241 473.588 250.713 463.234 251.589C374.344 259.186 301.322 262.995 211.753 255.967C191.944 254.413 74.6191 233.353 69.6285 238.475C56.0793 252.355 115.267 319.675 126.474 330.315C134.223 337.692 172.068 370.925 180.058 370.991C197.066 371.166 270.021 310.152 297.098 313.676C306.247 314.858 440.514 399.845 453.866 410.748C475.799 428.656 487.553 462.414 450.561 455.715C417.968 449.804 310.8 361.402 287.445 363.153C272.976 364.248 180.233 422.548 161.649 434.392C147.859 443.171 53.7153 505.039 51.0886 511.913C46.8203 523.1 109.51 735.633 120.039 741.369C122.775 742.858 125.401 740.559 127.656 739.421C163.4 721.491 237.801 615.815 279.63 591.799C289.874 585.932 309.246 585.012 311.982 598.739C310.8 607.452 308.327 615.771 296.2 629.761C277.245 651.631 266.782 661.987 255.443 674.772C224.821 704.743 76.2827 852.364 70.0882 883.167C67.2645 897.178 87.0083 917.254 95.8951 928.441C157.228 1005.7 262.382 1080.16 353.943 1116.52C360.97 1119.3 392.796 1134.8 395.248 1127.29L305.766 759.014H349.5C366.223 833.143 387.915 906.285 406.345 979.91C420.507 1036.39 430.379 1094.19 445.701 1150.5C447.825 1158.29 456.405 1198.86 458.66 1201.51C464.591 1208.49 546.981 1203.28 551.578 1198.9C554.292 1196.32 552.65 1164.09 552.847 1157.06C554.533 1098.2 541.553 1086.5 581.281 1038.95C585.725 1033.63 615.69 1011.13 610.984 1003.86C607.504 998.519 549.739 985.405 539.736 982.077C505.48 970.759 445.351 965.921 481.774 918.633C486.043 913.094 532.819 870.535 536.453 870.535H623.921C629.086 870.535 627.313 824.539 627.27 819.066C626.679 695.482 610.306 563.93 613.961 440.894C614.355 427.517 614.29 410.266 620.615 398.138C633.793 372.874 684.203 357.593 711.301 358.841C770.62 361.599 883.807 439.755 830.464 506.331C785.395 562.594 684.028 532.273 684.028 471.412V409.084C649.356 413.594 658.221 442.777 657.783 468.128C654.981 631.074 679.978 802.953 673.083 964.607C670.632 1022.05 663.649 1013.19 629.349 1054.28C620.287 1065.14 603.564 1074.9 598.267 1089.9C591.525 1108.94 596.166 1119.78 596.56 1137.41C596.603 1139.59 596.472 1141.78 596.56 1143.97V1183.34L812.559 1134.69L850.843 811.031L957.551 674.816L870.346 412.959C871.287 391.767 964.774 319.675 963.767 309.889C869.952 194.646 718.371 219.713 588.964 240.708C584.039 246.05 584.105 331.059 583.448 345.639C577.232 485.708 575.349 626.061 569.855 766.173C566.681 790.343 470.83 782.133 464.066 774.514C457.521 767.115 458.178 747.061 466.671 741.719C479.126 733.882 523.1 746.798 528.77 731.649C527.128 600.337 543.785 464.275 542.012 333.708L541.925 244.999L541.969 245.021ZM733.277 406.938C730.169 407.924 731.045 464.932 732.161 471.456C738.772 510.337 797.828 493.764 801.286 470.449C804.176 450.964 741.836 404.224 733.299 406.938H733.277ZM628.342 909.92H558.363C554.008 909.92 535.38 928.703 529.864 931.725L531.112 937.198L632.676 962.462L628.342 909.92Z" fill="black"/>
            <path d="M323.561 436.318C290.093 437.128 244.718 458.102 225.849 486.649C191.353 538.841 294.778 578.27 337.001 575.533C365.916 573.672 414.838 550.225 431.189 525.903C463.388 477.98 363.771 435.355 323.561 436.318Z" fill="black"/>
            <path d="M627.899 910H545.541C540.414 910 518.492 928.59 512 931.58L513.468 936.997L633 962L627.899 910Z" fill="#FFF9F0"/>
            <path d="M348.34 462.108C332.755 460.553 323.167 467.603 312.77 479.753C293.771 501.974 326.823 526.319 346.567 527.479C360.094 528.267 384.15 520.211 393.124 509.877C410.811 489.495 367.033 463.991 348.34 462.108Z" fill="#FFF9F0"/>
        </svg>
        <!-- End animated picasso.svg content -->

        <!-- Wordmark (inline) -->
        <!-- Begin picasso-wordmark.svg content -->

        <svg class="wordmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 633.56 249.42" aria-hidden="true">
            <path d="M622.04,0c2.87,7.45,2.77,15.52,4.69,23.46,1.74,7.2,4.92,14.17,6.82,21.33v10.34c-6.47,14.69-29.56,22.73-44.42,26.33-18.88,4.57-26.56,3.96-20.12-17.77,6.89-23.27,26.88-50.51,47.27-63.68h5.76ZM613.97,35.61c-2.79-2.15-14.16,14.91-14.75,18.08-1.37,7.32,4.75,11.39,10.73,7.17,10.39-7.33,6.62-14.69,4.02-25.25Z"/>
            <path d="M631.25,103.37c.38,1.87-.47,2.38-1.87,3.29-3.49,2.27-21.13,4.57-26.68,5.55-78.55,13.98-157.82,24.48-236.56,37.42-84.27,13.85-168.33,30.27-252.73,43.11-13.23,2.01-29.4,5.42-42.45,5.95-3.16.13-5.64-.25-8.59-1.18-3.41-5.05,14.65-11.46,17.82-12.64,30.34-11.3,74.1-20.71,106.31-27.2,106.12-21.38,220.04-36.5,327.87-47.41,33.38-3.38,72.97-8.88,105.98-9.23,3.81-.04,7.24,1.73,10.89,2.34Z"/>
            <path d="M.18,249.2c-1.15-1.37,3.48-15.42,4.29-18.1,15.12-49.89,33.93-98.76,48.98-148.68,3.01-9.99,7.42-21.94,9.52-31.85,1.03-4.9,2.41-10.14.53-14.95-5.82-3.97-19.43,24.47-31.46,20.49-13.38-15.87,7.29-39.93,24.09-42.22,34.44-4.7,85.19,15.77,89,54.59,2.39,24.33-19.61,44.31-43.66,38.94-4.26-2.71,7.24-15.56,8.36-19.31,2.09-7.04-.24-23.26-1.75-30.92-1.15-5.81-4.99-19.06-9.42-22.76-4.09-3.4-23.86-5.58-26.58-1.12-2.4,3.93,12.78,33.91,13.25,42.08.39,6.76-14.69,37.3-18.52,45.62-15.95,34.62-33.49,70.44-50.67,104.51-2.77,5.49-6.35,14.44-9.7,19.04-.66.9-5.13,6-6.25,4.66Z"/>
            <path d="M352.57,94.16c2.29,2.3,20.3-12.87,23.57-14.96,9.16-5.85,19.07-11.06,28.62-16.24,8.61-4.67,34.98-19.66,42.94-20.42,10.51-1.01,40.86,19.68,41.89,30.5.92,9.65-22.06,18.17-29.88,19.46-3.12.52-6.13.73-9.28.51.05-8.06,5.45-13.32,1.4-21.5-1.32-2.65-10.34-11.4-12.99-12.4-3.11-1.17-8.69,2.56-11.79,4.26-29.3,16.03-59.96,47.04-95.85,44.61-7.75-.53-19.47-5.97-25.21-5.71-11.44.52-29.68,15.8-47.26,17.19-14.82,1.17-40.82.19-39.76-20.11.99-18.89,22.97-65.91,46.59-61.44,18.23,3.45-14.36,32.93-18.41,37.86-5.11,6.23-17.81,20.34-9.04,27.42,10.81,8.72,46.87,7.32,55.72-3.83,10.02-12.63-6.21-35.4,19.78-43.44,6.96-2.15,16.82-.84,21.96-3.36,5.33-2.62,7.05-11.69,14.78-15.12,17.14-7.6,15.49,16.55,13.18,26.92-2.26,10.19-11.29,18.64-10.99,29.79ZM333.83,64.52c-16.84,3.5,6.14,30.31,8.93,29.65,6.12-6.81,2.97-32.13-8.93-29.65Z"/>
            <path d="M504.95,87.63c2.7-3.19,9.34-6.02,12.89-10.66,7.19-9.39,6.37-26.7,1.79-37.22l-2.92-.75c-1.07.33-2.05,5.65-5.22,4.63-2.87-3.26,8.31-32.92,15.38-34.36,3.9.68,15.38,24.98,17.4,29.81,6.99,16.73,14.9,35.88-6.31,45.31-4.62,2.05-27.79,8.84-31.78,8.57-3.42-.23-3.1-3.12-1.22-5.33Z"/>
            <path d="M178.39,80.61c14.36-2.75,19.17,31.71,15.87,41.16-2.86,8.19-12.05,15.49-20.57,10.1-11.38-7.2-14.72-30.1-8.17-41.06,1.84-3.08,9.31-9.52,12.87-10.2Z"/>
            <path d="M191.92,42.91c4.47-.03,18.36,12.96,13.26,18.55-8.14,8.94-26.79-18.47-13.26-18.55Z"/>
        </svg>

        <!-- Inline tracking toggle placed within the header row -->
        <div id="tracking-toggle-container">
            <button id="tracking-toggle" aria-pressed="true" title="Toggle Quick Mode (ON: fast styling only | OFF: full AI inference)" aria-label="Toggle Quick Mode">
                <!-- Inline zap icon (icon-only button, no text) -->
                <svg id="tracking-toggle-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <path d="M13 2L3 14h7l-1 8 10-12h-7l1-8z"></path>
                </svg>
            </button>
        </div>
    </div>

    <div class="button-container">
        <div class="frame-selectors">
            <!-- Context frame pill (shown when selected) -->
            <div id="context-pill" class="frame-pill" style="display: none;">
                <span class="frame-pill-icon">üìê</span>
                <span id="context-pill-label" class="frame-pill-label">Context</span>
                <button id="context-pill-remove" class="frame-pill-remove" title="Remove context frame">√ó</button>
            </div>
            
            <!-- Context select button (shown when no context) -->
            <button id="select-context" class="frame-select-button">
                <span class="frame-select-button-icon">+</span>
                <span>Select Context</span>
            </button>

            <!-- Canvas frame pill (shown when selected) -->
            <div id="canvas-pill" class="frame-pill" style="display: none;">
                <span class="frame-pill-icon">üé®</span>
                <span id="canvas-pill-label" class="frame-pill-label">Canvas</span>
                <button id="canvas-pill-remove" class="frame-pill-remove" title="Remove canvas frame">√ó</button>
            </div>
            
            <!-- Canvas select button (shown when no canvas) -->
            <button id="select-canvas" class="frame-select-button">
                <span class="frame-select-button-icon">+</span>
                <span>Select Canvas</span>
            </button>
        </div>
        <div class="textarea-wrapper">
            <textarea 
                id="additional-context" 
                placeholder="What do you want to do?"
                class="minimal-textarea"
                rows="1"
                aria-label="Additional notes"
            ></textarea>
            <div class="textarea-underline" aria-hidden="true"></div>
        </div>

        <!-- Event stream: uses remaining vertical space in the button container -->
        <div id="event-stream" class="event-stream" aria-live="polite" aria-atomic="false"></div>

    <div id="status" class="status" style="display:none"></div>
    <div id="interpretation" class="interpretation" style="display:none"></div>

    <script>
        let isTracking = true; // Quick mode enabled by default
        let contextFrameId = null;
        let canvasFrameId = null;

        // Tracking toggle handler (top-right) - toggles quick mode
        document.getElementById('tracking-toggle').onclick = (e) => {
            isTracking = !isTracking;
            const btn = e.currentTarget;
            btn.setAttribute('aria-pressed', String(isTracking));
            if (isTracking) {
                // Enable quick mode
                parent.postMessage({ pluginMessage: { type: 'start-tracking' } }, '*');
            } else {
                // Disable quick mode (full inference)
                parent.postMessage({ pluginMessage: { type: 'stop-tracking' } }, '*');
            }
            updateToggleUI();
        };

        // Frame selector handlers
        document.getElementById('select-context').onclick = () => {
            parent.postMessage({ pluginMessage: { type: 'select-context' } }, '*');
        };

        document.getElementById('select-canvas').onclick = () => {
            parent.postMessage({ pluginMessage: { type: 'select-canvas' } }, '*');
        };

        // Frame pill click handlers (to reselect)
        document.getElementById('context-pill').onclick = () => {
            parent.postMessage({ pluginMessage: { type: 'select-context' } }, '*');
        };

        document.getElementById('canvas-pill').onclick = () => {
            parent.postMessage({ pluginMessage: { type: 'select-canvas' } }, '*');
        };

        // Frame remove handlers
        document.getElementById('context-pill-remove').onclick = (e) => {
            e.stopPropagation();
            // Hide pill, show select button
            document.getElementById('context-pill').style.display = 'none';
            document.getElementById('select-context').style.display = 'inline-flex';
            // Clear the stored frame ID
            contextFrameId = null;
            parent.postMessage({ pluginMessage: { type: 'clear-context' } }, '*');
        };

        document.getElementById('canvas-pill-remove').onclick = (e) => {
            e.stopPropagation();
            // Hide pill, show select button
            document.getElementById('canvas-pill').style.display = 'none';
            document.getElementById('select-canvas').style.display = 'inline-flex';
            // Clear the stored frame ID
            canvasFrameId = null;
            parent.postMessage({ pluginMessage: { type: 'clear-canvas' } }, '*');
        };

        // Save additional context when changed and auto-resize the textarea
        const additionalContextInput = document.getElementById('additional-context');

            function autoResizeTextarea(/* el */) {
                    const el = additionalContextInput;
                    if (!el) return;
                    // reset to let scrollHeight be accurate
                    el.style.height = 'auto';
                    // compute content height
                    const contentHeight = el.scrollHeight;
                    // wrapper is the fixed-height container
                    const wrapper = el.closest('.textarea-wrapper');
                    const maxHeight = wrapper ? wrapper.clientHeight : 200;
                    const newHeight = Math.min(contentHeight, maxHeight);
                    el.style.height = newHeight + 'px';
                    el.style.overflowY = contentHeight > maxHeight ? 'auto' : 'hidden';

                    // position the underline element directly under the live text
                    const underline = wrapper ? wrapper.querySelector('.textarea-underline') : null;
                    if (underline) {
                        if (contentHeight <= maxHeight) {
                            // place underline immediately after the visible text
                            underline.style.top = newHeight + 'px';
                            underline.style.bottom = 'auto';
                        } else {
                            // content overflows: keep the underline anchored to the bottom of the wrapper
                            underline.style.top = '';
                            underline.style.bottom = '0px';
                        }
                    }
                }

        additionalContextInput.addEventListener('input', (e) => {
                const el = e.target;
                // keep fixed height
                autoResizeTextarea();

                const context = el.value.trim();
            parent.postMessage({ 
                pluginMessage: { 
                    type: 'save-additional-context',
                    context: context
                } 
            }, '*');
        });

            // ensure fixed height initial
            autoResizeTextarea();

        // Request saved additional context on load
        parent.postMessage({ pluginMessage: { type: 'get-additional-context' } }, '*');

        window.onmessage = (event) => {
            const msg = event.data.pluginMessage;
            const statusEl = document.getElementById('status');
            const interpretationEl = document.getElementById('interpretation');
            const eventStream = document.getElementById('event-stream');
            function appendEvent(title, detail) {
                if (!eventStream || !title) return;
                const wrapper = document.createElement('div');
                wrapper.className = 'event';

                const t = document.createElement('div');
                t.className = 'event-title';
                t.textContent = title;
                wrapper.appendChild(t);

                if (detail) {
                    const d = document.createElement('div');
                    d.className = 'event-detail';
                    d.textContent = detail;
                    wrapper.appendChild(d);
                }

                eventStream.appendChild(wrapper);
                // keep scroll at bottom for new events
                eventStream.scrollTop = eventStream.scrollHeight;
                // cap to prevent unbounded growth
                if (eventStream.children.length > 500) {
                    eventStream.removeChild(eventStream.firstChild);
                }
            }
            
            if (msg.type === 'context-selected') {
                contextFrameId = msg.frameId;
                const ctxName = msg.frameName || 'Context';
                const ctxDisplay = ctxName.length > 24 ? ctxName.slice(0, 21) + '‚Ä¶' : ctxName;
                
                // Show pill, hide select button
                const ctxPill = document.getElementById('context-pill');
                const ctxBtn = document.getElementById('select-context');
                const ctxLabel = document.getElementById('context-pill-label');
                
                if (ctxPill) ctxPill.style.display = 'inline-flex';
                if (ctxBtn) ctxBtn.style.display = 'none';
                if (ctxLabel) {
                    ctxLabel.textContent = ctxDisplay;
                    ctxLabel.title = ctxName;
                }
            } else if (msg.type === 'canvas-selected') {
                canvasFrameId = msg.frameId;
                const canName = msg.frameName || 'Canvas';
                const canDisplay = canName.length > 24 ? canName.slice(0, 21) + '‚Ä¶' : canName;
                
                // Show pill, hide select button
                const canPill = document.getElementById('canvas-pill');
                const canBtn = document.getElementById('select-canvas');
                const canLabel = document.getElementById('canvas-pill-label');
                
                if (canPill) canPill.style.display = 'inline-flex';
                if (canBtn) canBtn.style.display = 'none';
                if (canLabel) {
                    canLabel.textContent = canDisplay;
                    canLabel.title = canName;
                }
            } else if (msg.type === 'additional-context-loaded') {
                if (msg.context) {
                    additionalContextInput.value = msg.context;
                    // adjust textarea size & underline after loading
                    try { autoResizeTextarea(); } catch (e) { /* ignore */ }
                }
            } else if (msg.type === 'tracking-started') {
                isTracking = true;
                updateToggleUI();
                statusEl.className = 'status visible success';
                statusEl.textContent = '‚úì Tracking active. Move any object!';
                interpretationEl.className = 'interpretation';
            } else if (msg.type === 'tracking-stopped') {
                isTracking = false;
                updateToggleUI();
                statusEl.className = 'status visible';
                statusEl.textContent = 'Tracking stopped.';
                interpretationEl.className = 'interpretation';
            } else if (msg.type === 'processing') {
                statusEl.className = 'status visible processing';
                statusEl.textContent = msg.message;
                interpretationEl.className = 'interpretation';
                window.startLogoAnimations();
            } else if (msg.type === 'intent-extraction') {
                statusEl.className = 'status visible processing';
                statusEl.textContent = 'üß† ' + msg.message;
                interpretationEl.className = 'interpretation';
                window.startLogoAnimations();
            } else if (msg.type === 'intent-extracted') {
                interpretationEl.className = 'interpretation visible';
                interpretationEl.innerHTML = `
                    <div class="interpretation-title">User Intent Detected</div>
                    <div class="interpretation-text">${msg.intent}</div>
                    <div class="actions-count">Pattern: ${msg.pattern}</div>
                    <div style="font-size:10px;color:#666;margin-top:8px;">
                        üîì ${msg.objectsToMoveCount} object(s) to move ‚Ä¢ 
                        üîí ${msg.objectsToKeepFixedCount} object(s) fixed
                    </div>
                    <div style="font-size:10px;color:#999;margin-top:4px;">${msg.fixedReasoning}</div>
                `;
                statusEl.className = 'status visible success';
                statusEl.textContent = '‚úÖ Intent extracted. Starting arrangement...';
            } else if (msg.type === 'arrangement-started') {
                statusEl.className = 'status visible processing';
                statusEl.textContent = `üéØ Arranging to satisfy: "${msg.intent}"`;
                window.startLogoAnimations();
            } else if (msg.type === 'arrangement-iteration') {
                statusEl.className = 'status visible processing';
                statusEl.textContent = `üîÑ Arrangement iteration ${msg.iteration}/${msg.maxIterations}...`;
                window.startLogoAnimations();
            } else if (msg.type === 'arrangement-evaluation') {
                if (msg.intentSatisfied) {
                    statusEl.className = 'status visible success';
                    statusEl.textContent = `‚úÖ Iteration ${msg.iteration}: Intent perfectly satisfied!`;
                } else {
                    statusEl.className = 'status visible processing';
                    statusEl.textContent = `‚öôÔ∏è Iteration ${msg.iteration}: Applying ${msg.correctionsCount} correction(s)...`;
                }
            } else if (msg.type === 'arrangement-complete') {
                statusEl.className = 'status visible success';
                statusEl.textContent = msg.message;
                window.stopLogoAnimations();
            } else if (msg.type === 'interpretation') {
                interpretationEl.className = 'interpretation visible';
                interpretationEl.innerHTML = `
                    <div class="interpretation-title">AI Interpretation</div>
                    <div class="interpretation-text">${msg.interpretation}</div>
                    <div class="actions-count">${msg.actionsCount} layout ${msg.actionsCount === 1 ? 'change' : 'changes'} applied</div>
                `;
            } else if (msg.type === 'actions-applied') {
                statusEl.className = 'status visible success';
                statusEl.textContent = '‚ú® ' + msg.message;
                window.stopLogoAnimations();
            } else if (msg.type === 'refinement-started') {
                statusEl.className = 'status visible processing';
                statusEl.textContent = 'üîÑ ' + msg.message;
                window.startLogoAnimations();
            } else if (msg.type === 'validation-step') {
                statusEl.className = 'status visible processing';
                statusEl.textContent = `üîç ${msg.message}`;
                window.startLogoAnimations();
            } else if (msg.type === 'validation-result') {
                if (msg.isAligned) {
                    statusEl.className = 'status visible success';
                    statusEl.textContent = `‚úÖ Iteration ${msg.iteration}: Perfect alignment!`;
                } else {
                    statusEl.className = 'status visible processing';
                    statusEl.textContent = `‚öôÔ∏è Iteration ${msg.iteration}: Found ${msg.issues.length} issues, applying ${msg.suggestionsCount} fixes...`;
                }
            } else if (msg.type === 'refinement-complete') {
                statusEl.className = 'status visible success';
                statusEl.textContent = msg.message;
                window.stopLogoAnimations();
            } else if (msg.type === 'error') {
                statusEl.className = 'status visible error';
                statusEl.textContent = '‚ö†Ô∏è ' + msg.message;
                window.stopLogoAnimations();
            } else if (msg.type === 'actions-generated') {
                // Display the generated actions
                interpretationEl.className = 'interpretation visible';
                const actionsHTML = msg.actions.map((action, i) => {
                    return `
                        <div style="margin-bottom: 12px; padding: 8px; background: #f5f5f5; border-radius: 4px;">
                            <div style="font-weight: 500; margin-bottom: 4px;">${i + 1}. ${action.type.toUpperCase()}</div>
                            <div style="font-size: 11px; color: #666; margin-bottom: 4px;">${action.description}</div>
                            <div style="font-size: 10px; color: #999;">${action.constraints.length} constraint(s)</div>
                        </div>
                    `;
                }).join('');
                
                interpretationEl.innerHTML = `
                    <div class="interpretation-title">Generated Actions</div>
                    <div style="font-size: 11px; max-height: 200px; overflow-y: auto;">
                        ${actionsHTML}
                    </div>
                    <div class="actions-count">${msg.count} action(s) generated</div>
                `;
            } else if (msg.type === 'execution-started') {
                statusEl.className = 'status visible processing';
                statusEl.textContent = 'üîÑ Parsing and executing actions...';
                interpretationEl.className = 'interpretation';
                window.startLogoAnimations();
                const apiCallsEl = document.getElementById('api-calls');
                if (apiCallsEl) {
                    apiCallsEl.className = 'api-calls-box';
                    apiCallsEl.innerHTML = '';
                }
            } else if (msg.type === 'execution-progress') {
                statusEl.className = 'status visible processing';
                statusEl.textContent = msg.message;
                window.startLogoAnimations();
            } else if (msg.type === 'execution-complete') {
                statusEl.className = 'status visible success';
                statusEl.textContent = `‚úÖ Execution complete! Created: ${msg.created}, Modified: ${msg.modified}`;
                window.stopLogoAnimations();

                // Display API calls
                const apiCallsEl = document.getElementById('api-calls');
                if (apiCallsEl) {
                    if (msg.apiCalls && msg.apiCalls.length > 0) {
                        apiCallsEl.className = 'api-calls-box visible';
                        apiCallsEl.innerHTML = `
                            <div class="api-calls-title">API Calls</div>
                            ${msg.apiCalls.map((apiCall, index) => {
                            const isSuccess = apiCall.response.status >= 200 && apiCall.response.status < 300;
                            const requestBodyStr = JSON.stringify(apiCall.request.body, null, 2);
                            const responseBodyStr = JSON.stringify(apiCall.response.body, null, 2);
                            const timestamp = new Date(apiCall.timestamp).toLocaleTimeString();

                            return `
                                    <div class="api-call-item">
                                        <div class="api-call-method">${apiCall.request.method} ${apiCall.request.url}</div>
                                        <div class="api-call-url">${timestamp}</div>
                                        <span class="api-call-status ${isSuccess ? 'success' : 'error'}">
                                            ${apiCall.response.status} ${apiCall.response.statusText}
                                        </span>
                                        <div class="api-call-section">
                                            <div class="api-call-section-title">Request</div>
                                            <div class="api-call-content">${escapeHtml(requestBodyStr)}</div>
                                        </div>
                                        <div class="api-call-section">
                                            <div class="api-call-section-title">Response</div>
                                            <div class="api-call-content">${escapeHtml(responseBodyStr)}</div>
                                        </div>
                                    </div>
                                `;
                        }).join('')}
                        `;
                    } else {
                        apiCallsEl.className = 'api-calls-box';
                    }
                }

                if (msg.errors && msg.errors.length > 0) {
                    statusEl.textContent += ` (${msg.errors.length} error(s))`;
                    interpretationEl.className = 'interpretation visible';
                    interpretationEl.innerHTML = `
                        <div class="interpretation-title">Execution Errors</div>
                        <div class="interpretation-text" style="font-size: 10px;">
                            ${msg.errors.map(e => `‚Ä¢ ${e}`).join('<br>')}
                        </div>
                    `;
                } else {
                    interpretationEl.className = 'interpretation visible';
                    interpretationEl.innerHTML = `
                        <div class="interpretation-title">Execution Summary</div>
                        <div class="interpretation-text">${msg.summary || 'Actions executed successfully'}</div>
                        <div class="actions-count">Created: ${msg.created} ‚Ä¢ Modified: ${msg.modified}</div>
                    `;
                }
            } else if (msg.type === 'save-screenshot') {
                // Save screenshot to downloads folder
                saveScreenshot(msg.screenshot, msg.filename);
            } else if (msg.type === 'action-description-loaded') {
                // Load action description from plugin storage
                const actionDescriptionEl = document.getElementById('action-description');
                if (actionDescriptionEl && msg.description) {
                    actionDescriptionEl.value = msg.description;
                }
            }
            // Append a compact, human-readable event to the event stream with more context
            try {
                let title = '';
                let detail = '';

                if (msg.type === 'context-selected') {
                    title = 'Context selected';
                    detail = msg.frameName ? `${msg.frameName} (${msg.frameId || 'id'})` : (msg.frameId || 'frame selected');
                } else if (msg.type === 'canvas-selected') {
                    title = 'Canvas selected';
                    detail = msg.frameName ? `${msg.frameName} (${msg.frameId || 'id'})` : (msg.frameId || 'frame selected');
                } else if (msg.type === 'additional-context-loaded') {
                    title = msg.context ? 'Loaded saved notes' : 'No saved notes';
                    detail = msg.context ? (msg.context.length > 120 ? msg.context.slice(0, 117) + '‚Ä¶' : msg.context) : '';
                } else if (msg.type === 'tracking-started') {
                    title = 'Quick mode enabled';
                    detail = '';
                } else if (msg.type === 'tracking-stopped') {
                    title = 'Quick mode disabled';
                    detail = 'Predicting larger changes...';
                } else if (msg.type === 'processing') {
                    title = msg.message || 'Processing‚Ä¶';
                    detail = msg.step ? `Step: ${msg.step}` : '';
                } else if (msg.type === 'intent-extraction') {
                    title = 'Extracting intent‚Ä¶';
                    detail = msg.message || '';
                } else if (msg.type === 'intent-extracted') {
                    title = `Intent: ${msg.intent || 'detected'}`;
                    detail = `Pattern: ${msg.pattern || 'n/a'} ‚Äî ${msg.objectsToMoveCount || 0} to move, ${msg.objectsToKeepFixedCount || 0} fixed`;
                } else if (msg.type === 'arrangement-started') {
                    title = 'Arrangement started';
                    detail = msg.intent || '';
                } else if (msg.type === 'arrangement-iteration') {
                    title = `Iteration ${msg.iteration}/${msg.maxIterations || '?'} started`;
                    detail = `Corrections: ${msg.correctionsCount || 0}`;
                } else if (msg.type === 'arrangement-evaluation') {
                    title = `Iteration ${msg.iteration} evaluation`;
                    detail = msg.intentSatisfied ? 'Intent satisfied' : `Applying ${msg.correctionsCount || 0} corrections`;
                } else if (msg.type === 'arrangement-complete') {
                    title = 'Arrangement complete';
                    detail = msg.message || '';
                } else if (msg.type === 'interpretation') {
                    title = 'AI interpretation';
                    detail = msg.interpretation || '';
                } else if (msg.type === 'actions-applied') {
                    title = 'Actions applied';
                    detail = msg.message || '';
                } else if (msg.type === 'refinement-started') {
                    title = 'Refinement started';
                    detail = msg.message || '';
                } else if (msg.type === 'validation-step') {
                    title = 'Validation';
                    detail = msg.message || '';
                } else if (msg.type === 'validation-result') {
                    title = `Validation ${msg.iteration || ''}`.trim();
                    detail = msg.isAligned ? 'Aligned' : `${msg.issues?.length || 0} issues found`;
                } else if (msg.type === 'refinement-complete') {
                    title = 'Refinement complete';
                    detail = msg.message || '';
                } else if (msg.type === 'error') {
                    title = 'Error';
                    detail = msg.message || 'Unknown error';
                } else if (msg.type === 'save-screenshot') {
                    title = 'Screenshot saved';
                    detail = msg.filename || 'image.png';
                } else {
                    title = msg.type;
                    detail = msg.message || '';
                }

                if (title) appendEvent(title, detail);
            } catch (e) {
                // swallow summarization errors
            }
        };

        function saveScreenshot(base64Data, filename) {
            try {
                // Convert base64 to blob
                const byteCharacters = atob(base64Data);
                const byteNumbers = new Array(byteCharacters.length);
                for (let i = 0; i < byteCharacters.length; i++) {
                    byteNumbers[i] = byteCharacters.charCodeAt(i);
                }
                const byteArray = new Uint8Array(byteNumbers);
                const blob = new Blob([byteArray], { type: 'image/png' });

                // Create download link
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                console.log('Screenshot saved:', filename);
            } catch (error) {
                console.error('Failed to save screenshot:', error);
            }
        }

        function updateToggleUI() {
            const toggle = document.getElementById('tracking-toggle');
            // indicate active via icon color and glow
            if (toggle) {
                toggle.style.filter = isTracking ? 'drop-shadow(0 0 12px rgba(90,157,95,0.6)) drop-shadow(0 0 6px rgba(90,157,95,0.4))' : 'none';
                toggle.style.color = isTracking ? '#5a9d5f' : 'rgba(0,0,0,0.66)';
                toggle.setAttribute('aria-pressed', String(isTracking));
            }
        }

        // No external icon library (CSP); icons are inlined above.
        updateToggleUI();

        // ======================
        // LOGO & WORDMARK ANIMATION
        // ======================
        const logo = document.querySelector('.logo');
        const wordmark = document.querySelector('.wordmark');
        let logoAnimationInterval = null;
        let wordmarkAnimationInterval = null;
        let isAnimating = false;
        
        // Logo animation variables
        let currentElement = null;
        let previousIndex = -1;
        
        function animateRandomLogoElement() {
            if (!logo) return;
            
            const paths = logo.querySelectorAll('path');
            
            // Pick a random path element (different from the previous one)
            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * paths.length);
            } while (randomIndex === previousIndex && paths.length > 1);
            
            // Reset previous element (if it exists)
            if (currentElement) {
                currentElement.style.transform = 'rotate(0deg) scale(1) translate(0px, 0px)';
            }
            
            currentElement = paths[randomIndex];
            previousIndex = randomIndex;
            
            // Get the bounding box to determine element size
            const bbox = currentElement.getBBox();
            const elementArea = bbox.width * bbox.height;
            
            // Calculate size factor (smaller elements = higher factor)
            const sizeFactor = Math.max(0.5, 1 / (elementArea / 30000));
            
            // Generate random transforms
            const tiltAngle = (Math.random() - 0.5) * Math.max(10, 30 * sizeFactor);
            const baseScale = 1.05 + Math.random() * 0.08;
            const scale = Math.max(1.02, 1 + (baseScale - 1) * sizeFactor);
            const translateX = (Math.random() - 0.5) * Math.max(6, 20 * sizeFactor);
            const translateY = (Math.random() - 0.5) * Math.max(6, 20 * sizeFactor);
            
            // Apply the transform
            currentElement.style.transform = `rotate(${tiltAngle}deg) scale(${scale}) translate(${translateX}px, ${translateY}px)`;
        }
        
        function animateWordmark() {
            if (!wordmark) return;
            
            // Generate a random tilt angle between -4 and 4 degrees
            const tiltAngle = (Math.random() - 0.5) * 8;
            wordmark.style.transform = `rotate(${tiltAngle}deg)`;
        }
        
        function startAnimations() {
            if (isAnimating) return; // Already animating
            
            isAnimating = true;
            
            // Start logo animation
            if (logo) {
                animateRandomLogoElement(); // Animate immediately
                logoAnimationInterval = setInterval(animateRandomLogoElement, 450);
            }
            
            // Start wordmark animation
            if (wordmark) {
                animateWordmark(); // Animate immediately
                wordmarkAnimationInterval = setInterval(animateWordmark, 1200);
            }
        }
        
        function stopAnimations() {
            if (!isAnimating) return; // Already stopped
            
            isAnimating = false;
            
            // Stop logo animation
            if (logoAnimationInterval) {
                clearInterval(logoAnimationInterval);
                logoAnimationInterval = null;
            }
            
            // Reset all logo paths to default
            if (logo) {
                const paths = logo.querySelectorAll('path');
                paths.forEach(path => {
                    path.style.transform = 'rotate(0deg) scale(1) translate(0px, 0px)';
                });
                currentElement = null;
                previousIndex = -1;
            }
            
            // Stop wordmark animation
            if (wordmarkAnimationInterval) {
                clearInterval(wordmarkAnimationInterval);
                wordmarkAnimationInterval = null;
            }
            
            // Reset wordmark to default
            if (wordmark) {
                wordmark.style.transform = 'rotate(0deg)';
            }
        }
        
        // Expose animation controls globally
        window.startLogoAnimations = startAnimations;
        window.stopLogoAnimations = stopAnimations;
        
        // Initialize UI state (quick mode is on by default)
        updateToggleUI();
    </script>
</body>

</html>
